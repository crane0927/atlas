# 功能规格说明

## 宪法检查

本规格说明必须符合项目宪法要求：

- ✅ **技术栈**: JDK 21, Spring Boot 4.0.1, Spring Cloud 2025.1.0, Spring Cloud Alibaba 2025.1.0
- ✅ **代码注释**: 所有代码使用中文注释
- ✅ **模块化**: 功能归属正确的模块
- ✅ **版本管理**: 遵循语义化版本规范

## 功能描述

建立 Atlas 项目的根工程和版本治理体系，确保所有子模块遵循统一的构建规范、依赖管理和工程约定。该功能包括：

1. **父 POM（atlas 根工程）**：建立统一的父 POM，管理 Java 版本、依赖版本、插件配置
2. **基础工程约定**：定义包名规范、日志格式、错误码段位分配、配置命名规范等标准

该功能是项目基础设施的核心部分，为所有后续开发提供统一的工程规范和治理框架。

## 功能需求

### FR1: 父 POM 统一管理

**需求描述**: 创建根工程的父 POM 文件，统一管理所有子模块的构建配置。

**具体要求**:
- 统一 Java 版本为 21（符合宪法原则 1）
- 统一 Spring Boot 版本为 4.0.1（符合宪法原则 2）
- 统一 Spring Cloud 和 Spring Cloud Alibaba 版本为 2025.1.0（符合宪法原则 3）
- 统一字符编码为 UTF-8
- 统一 Maven 编译版本和源代码版本

**验收标准**:
- 所有子模块继承父 POM 后，无需单独指定 Java 版本
- 所有子模块继承父 POM 后，无需单独指定 Spring Boot/Cloud 版本
- 所有子模块的构建配置保持一致

### FR2: 依赖版本管理

**需求描述**: 在父 POM 中统一管理所有依赖的版本号。

**具体要求**:
- 使用 `<dependencyManagement>` 统一管理依赖版本
- 包含 Spring Cloud 和 Spring Cloud Alibaba 的 BOM（Bill of Materials）
- 包含常用第三方库的版本管理（如 MyBatis-Plus、PostgreSQL 驱动等）
- 禁止子模块显式指定已在父 POM 中管理的依赖版本

**验收标准**:
- 所有子模块的依赖版本由父 POM 统一管理
- 不存在版本冲突
- 依赖版本升级只需在父 POM 中修改一处

### FR3: 插件管理

**需求描述**: 在父 POM 中统一配置和管理构建插件。

**具体要求**:
- **Maven Enforcer Plugin**: 强制依赖规则检查，确保依赖版本一致性
- **Maven Surefire Plugin**: 单元测试执行配置
- **Maven Failsafe Plugin**: 集成测试执行配置
- **Spotless/Checkstyle**: 代码格式化和代码风格检查
- **Maven Compiler Plugin**: Java 编译配置
- **其他必要插件**: 根据项目需要配置其他构建插件

**验收标准**:
- 所有子模块继承统一的插件配置
- 代码风格检查在构建时自动执行
- 测试执行配置统一且可配置

### FR4: 包名规范

**需求描述**: 定义统一的 Java 包名规范。

**具体要求**:
- 根包名：`com.atlas`
- 模块包名：`com.atlas.{module-name}`
- 子模块包名结构：`com.atlas.{module-name}.{layer}`（如 controller、service、mapper 等）
- 公共模块包名：`com.atlas.common.{infra|feature}.{module-name}`

**验收标准**:
- 所有模块的包名符合规范
- 包名结构清晰，便于代码组织
- 包名规范文档化

### FR5: 日志格式规范

**需求描述**: 定义统一的日志输出格式。

**具体要求**:
- 统一日志格式模板（包含时间、级别、线程、类名、消息等）
- 统一日志级别配置
- 统一日志输出目标（控制台、文件等）
- 支持链路追踪 ID（TraceId）输出

**验收标准**:
- 所有模块的日志格式一致
- 日志信息包含必要的上下文信息
- 日志便于问题排查和监控

### FR6: 错误码段位分配

**需求描述**: 定义统一的错误码规范和段位分配规则。

**具体要求**:
- 定义错误码格式规范（如：模块码 + 错误类型码 + 序号）
- 为每个模块分配错误码段位
- 定义错误码常量类结构
- 错误码与错误消息的映射关系

**验收标准**:
- 所有模块的错误码不冲突
- 错误码格式统一且可追溯
- 错误码规范文档化

### FR7: 配置命名规范

**需求描述**: 定义 Nacos 配置中心的命名规范。

**具体要求**:
- **DataId 命名规范**: 定义配置文件的命名规则（如：`{application-name}-{profile}.{extension}`）
- **Group 命名规范**: 定义配置分组的命名规则
- **配置项命名规范**: 定义配置项 key 的命名规则（如：使用点分隔的层级结构）
- 配置命名与模块的对应关系

**验收标准**:
- 所有模块的配置命名符合规范
- 配置易于查找和管理
- 配置命名规范文档化

## 用户场景

### 场景 1: 开发人员创建新模块

**作为** 开发人员  
**我希望** 创建新的业务模块时，能够快速继承根工程的配置  
**以便** 无需重复配置 Java 版本、依赖版本等基础配置

**流程**:
1. 开发人员在子模块的 `pom.xml` 中继承父 POM
2. 子模块自动获得统一的 Java 版本、依赖版本、插件配置
3. 开发人员只需关注业务代码开发

### 场景 2: 配置管理员管理依赖版本

**作为** 配置管理员  
**我希望** 在父 POM 中统一管理所有依赖版本  
**以便** 版本升级时只需修改一处，所有子模块自动更新

**流程**:
1. 配置管理员在父 POM 中更新依赖版本
2. 所有子模块在下次构建时自动使用新版本
3. 避免版本不一致导致的兼容性问题

### 场景 3: 开发人员查看工程规范

**作为** 开发人员  
**我希望** 能够快速查阅包名、日志格式、错误码等工程规范  
**以便** 编写符合规范的代码

**流程**:
1. 开发人员查阅工程规范文档
2. 按照规范编写代码（包名、日志、错误码等）
3. 代码审查时验证是否符合规范

## 成功标准

1. **统一性**: 100% 的子模块继承父 POM 配置，无需重复配置基础项
2. **可维护性**: 依赖版本升级时间从"逐个模块修改"减少到"单点修改"，效率提升 90% 以上
3. **规范性**: 所有模块的包名、日志格式、错误码、配置命名符合规范，规范遵循率达到 100%
4. **文档完整性**: 工程规范文档完整，新成员可在 30 分钟内理解并应用规范
5. **构建一致性**: 所有模块的构建配置一致，构建成功率 100%

## 关键实体

### 父 POM 配置
- Java 版本配置
- 依赖版本管理（BOM）
- 插件配置（Enforcer、Surefire、Failsafe、Spotless/Checkstyle 等）
- 属性定义（编码、版本号等）

### 工程规范
- 包名规范文档
- 日志格式规范文档
- 错误码段位分配表
- 配置命名规范文档

## 假设

1. 项目使用 Maven 作为构建工具
2. 所有子模块采用相同的构建工具和配置方式
3. 团队已熟悉 Maven 和 Spring Boot 项目结构
4. 配置中心使用 Nacos

## 依赖关系

- 无外部依赖（这是基础设施功能）

## 约束

1. 必须符合项目宪法中的所有技术栈原则
2. 包名规范必须与模块结构原则（原则 10）保持一致
3. 配置命名规范必须支持多环境（dev、test、prod）
4. 错误码段位分配必须预留扩展空间

## 非功能需求

1. **可扩展性**: 父 POM 配置应支持未来新增模块和依赖
2. **文档化**: 所有规范必须有清晰的文档说明
3. **可验证性**: 规范应可通过工具自动检查（如 Enforcer、Checkstyle）

## 测试要求

1. **构建测试**: 验证所有子模块能够正确继承父 POM 配置并成功构建
2. **规范验证**: 使用工具验证包名、日志格式、错误码等是否符合规范
3. **版本一致性测试**: 验证所有模块使用的依赖版本与父 POM 定义一致

## 实现注意事项

- [ ] 确保父 POM 配置符合项目宪法要求
- [ ] 所有配置和规范使用中文注释
- [ ] 创建规范文档，便于团队查阅
- [ ] 使用 Maven Enforcer 插件强制规范执行
- [ ] 考虑向后兼容性，避免破坏现有模块

